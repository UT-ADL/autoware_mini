<?xml version="1.0"?>
<launch>

    <arg name="planner"                 default="waypoints"     doc="waypoints, lanelet2" />
    <arg name="waypoints_file"          default="waypoints_erm_utm_1m.csv" />
    <arg name="lanelet2_map_name"       default="tartu_demo_l_c_wp_dem.osm" />
    <arg name="use_local_planner"       default="false" />

    <group ns="planning">

        <!-- Remap topics -->
        <remap from="current_pose"          to="/localization/current_pose" />
        <remap from="current_velocity"      to="/localization/current_velocity" />
        <remap from="goal"                  to="/move_base_simple/goal" />
        <remap from="detected_objects"      to="/detection/detected_objects" />
        <remap from="traffic_light_status"  to="/detection/traffic_light_status" />

        <!-- Waypoint loader -->
        <node if="$(eval arg('planner')=='waypoints')"  pkg="autoware_mini" type="waypoint_loader.py" name="waypoint_loader" output="screen" required="true">
            <param name="waypoints_file" value="$(find autoware_mini)/data/trajectories/$(arg waypoints_file)" />
        </node>

        <!-- Lanelet2 map visualizer -->
        <node pkg="autoware_mini" type="lanelet2_map_visualizer.py" name="lanelet2_map_visualizer" output="screen" required="true">
            <param name="lanelet2_map_name" value="$(find autoware_mini)/data/lanelet2/$(arg lanelet2_map_name)" />
        </node>

        <!-- Lanelet2 global planner -->
        <node if="$(eval arg('planner')=='lanelet2')" pkg="autoware_mini" type="lanelet2_global_planner.py" name="lanelet2_global_planner" output="screen" required="true">
            <param name="lanelet2_map_name" value="$(find autoware_mini)/data/lanelet2/$(arg lanelet2_map_name)" />
        </node>
        <node pkg="autoware_mini" type="global_path_visualizer.py" name="global_path_visualizer" output="screen" required="true"/>

        <!-- Carla waypoints publisher -->
        <node if="$(eval arg('planner')=='carla')" pkg='autoware_mini' type='carla_waypoints_publisher.py' name='carla_waypoints_publisher' output='screen' required="true" />

        <!-- Path smoothing -->
        <node pkg="autoware_mini" type="path_smoothing.py" name="path_smoothing" output="screen" required="true">
            <remap unless="$(arg use_local_planner)" from="smoothed_path" to="local_path"/>
        </node>
        <node pkg="autoware_mini" type="global_path_visualizer.py" name="smoothed_path_visualizer" output="screen" required="true">
            <remap if="$(arg use_local_planner)" from="global_path" to="smoothed_path"/>
            <remap unless="$(arg use_local_planner)" from="global_path" to="local_path"/>
            <remap from="global_path_markers" to="smoothed_path_markers"/>
        </node>

        <!-- Local planner -->
        <group if="$(arg use_local_planner)">
            <node pkg="autoware_mini" type="local_planner.py" name="local_planner" output="screen" required="true">
                <param name="lanelet2_map_name" value="$(find autoware_mini)/data/lanelet2/$(arg lanelet2_map_name)" />
            </node>
            <node pkg="autoware_mini" type="local_path_visualizer.py" name="local_path_visualizer" output="screen" required="true"/>
        </group>

        <node pkg="autoware_mini" type="speed_obstacle_visualizer.py" name="speed_obstacle_visualizer" output="screen" required="true"/>

        <rosparam command="load" file="$(find autoware_mini)/config/planning.yaml" />

    </group>

</launch>