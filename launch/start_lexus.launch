<?xml version="1.0"?>
<launch>

    <arg name="use_detection"           default="false"         doc="use object detection" />
    <arg name="use_global_planner"      default="false"         doc="use lanelet2_global_planner" />
    <arg name="follower"                default="pure_pursuit"  doc="pure_pursuit, stanley" />
    
    <arg name="max_speed"               default="30" />
    <arg name="lanelet2_map"            default="tartu_demo_l_c_wp_dem.osm" />
    
    <!-- Vehicle platform -->
    <include file="$(find vehicle_platform)/launch/platform.launch" >
        <arg name="use_tf"          value="true" />
        <arg name="use_lexus_model" value="true" />
        <arg name="use_gnss"        value="true" />
        <arg name="use_dbw"         value="true" />
        <arg name="use_ssc"         value="true" />
    </include>

    <group ns="autoware_mini">

        <!-- Localizer -->
        <include file="$(find autoware_mini)/launch/localization.launch" />

        <!-- Lanelet2 map loader -->
        <node pkg="autoware_mini" type="lanelet2_map_loader.py" name="lanelet2_map_loader" output="screen" required="true">
            <param name="lanelet2_map" value="$(find autoware_mini)/data/lanelet2/$(arg lanelet2_map)" />
        </node>

        <!-- Lanelet2 global planner -->
        <node if="$(arg use_global_planner)" pkg="autoware_mini" type="lanelet2_global_planner.py" name="lanelet2_global_planner" output="screen" required="true">
            <param name="lanelet2_map" value="$(find autoware_mini)/data/lanelet2/$(arg lanelet2_map)" />
        </node>

        <!-- Waypoint_visualizer -->
        <node pkg="autoware_mini" type="waypoint_visualizer.py" name="waypoint_visualizer" output="screen" required="true"/>

        <!-- Detection -->
        <include if="$(arg use_detection)" file="$(find autoware_mini)/launch/detection.launch" />

        <!-- Follower -->
        <include file="$(find autoware_mini)/launch/control.launch">
            <arg name="follower" value="$(arg follower)" />
        </include>

        <!-- Vehicle -->
        <include file="$(find autoware_mini)/launch/vehicle.launch" >
            <arg name="max_speed" value="$(arg max_speed)" />
        </include>

        <!-- Rviz -->
        <node type="rviz" name="rviz" pkg="rviz" args="-d $(find autoware_mini)/rviz/autoware_mini.rviz" />

    </group>

</launch>